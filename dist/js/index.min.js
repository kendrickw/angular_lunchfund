"use strict";!function(){var t=angular.module("index",["ui.router","angular-loading-bar","ngMaterial","globalFactory","copyright","luncherSelect","fundForm","pastEvent","fundChart","fundStat","stockChart"]);t.config(["$stateProvider","$urlRouterProvider","$mdThemingProvider","$mdIconProvider",function(t,e,n,a){e.otherwise("/home"),t.state("home",{url:"/home",templateUrl:"app/routes/home.html"}).state("dashboard",{url:"/dashboard",templateUrl:"app/routes/dashboard.html"}).state("stock",{url:"/stock",templateUrl:"app/routes/stock.html",controller:"StockController",controllerAs:"StockCtrl"}).state("setting",{url:"/setting",templateUrl:"app/routes/setting.html"}),n.theme("default").primaryPalette("indigo").accentPalette("orange"),a.icon("action:home","images/material-svg/action/ic_home_24px.svg",24).icon("action:dashboard","images/material-svg/action/ic_dashboard_24px.svg",24).icon("action:settings","images/material-svg/action/ic_settings_24px.svg",24).icon("action:done","images/material-svg/action/ic_done_24px.svg",24).icon("action:exit-to-app","images/material-svg/action/ic_exit_to_app_24px.svg",24).icon("action:account-balance-wallet","images/material-svg/action/ic_account_balance_wallet_24px.svg",24).icon("action:trending-up","images/material-svg/action/ic_trending_up_24px.svg",24).icon("action:trending-down","images/material-svg/action/ic_trending_down_24px.svg",24).icon("content:undo","images/material-svg/content/ic_undo_24px.svg",24).icon("image:edit","images/material-svg/image/ic_edit_24px.svg",24).icon("navigation:chevron-right","images/material-svg/navigation/ic_chevron_right_24px.svg",24).icon("navigation:menu","images/material-svg/navigation/ic_menu_24px.svg",24).icon("navigation:expand-more","images/material-svg/navigation/ic_expand_more_24px.svg",24).icon("navigation:expand-less","images/material-svg/navigation/ic_expand_less_24px.svg",24).icon("file:cloud-upload","images/material-svg/file/ic_cloud_upload_24px.svg",24)}]),t.run(["$http","$templateCache",function(t,e){var n=["images/material-svg/action/ic_home_24px.svg","images/material-svg/action/ic_dashboard_24px.svg","images/material-svg/action/ic_settings_24px.svg","images/material-svg/action/ic_exit_to_app_24px.svg","images/material-svg/action/ic_done_24px.svg","images/material-svg/action/ic_account_balance_wallet_24px.svg","images/material-svg/action/ic_trending_up_24px.svg","images/material-svg/action/ic_trending_down_24px.svg","images/material-svg/content/ic_undo_24px.svg","images/material-svg/image/ic_edit_24px.svg","images/material-svg/navigation/ic_chevron_right_24px.svg","images/material-svg/navigation/ic_menu_24px.svg","images/material-svg/navigation/ic_expand_more_24px.svg","images/material-svg/navigation/ic_expand_less_24px.svg","images/material-svg/file/ic_cloud_upload_24px.svg"];angular.forEach(n,function(n){t.get(n,{cache:e})})}]),t.controller("MenuController",["global","$mdSidenav",function(t,e){function n(t){e(t).toggle()}function a(t){e(t).close()}var o=this,r=function(){return t.get("loginUser")},i=[{title:"Email",text:r().email},{title:"Firstname",text:r().firstname},{title:"Lastname",text:r().lastname}];angular.extend(o,{development:t.get("development"),allPages:t.get("allPages"),getCurrentPage:t.getCurrentPage,loginUser:r,userdetail:i,toggleSidemenu:n,closeSidemenu:a})}]),t.controller("StockController",["global","$http","$q","$window",function(t,e,n,a){function o(t){return r=n.defer(),e.jsonp("http://d.yimg.com/autoc.finance.yahoo.com/autoc",{params:{callback:"YAHOO.Finance.SymbolSuggest.ssCallback",query:t}}).error(function(t){r.reject(t)}),r.promise}var r,i=this;angular.extend(i,{symbols:[],selectedItem:null,searchText:null}),a.YAHOO={Finance:{SymbolSuggest:{}}},a.YAHOO.Finance.SymbolSuggest.ssCallback=function(t){var e=t.ResultSet.Result.map(function(t){return{symbol:t.symbol,name:t.name,exchange:t.exchDisp}});r.resolve(e)},angular.extend(i,{querySearch:o})}])}(),function(){var t=angular.module("globalFactory",[]);t.factory("global",["$location","$window","$http",function(t,e,n){function a(t){var e,n=r.lunchers;if(t<=n.length&&n[t-1].id===t)return n[t-1];for(e=0;e<n.length;e+=1)if(n[e].id===t)return n[e];return console.error("ID#"+t+" is not a valid luncher ID."),null}function o(){var e,n=new RegExp(t.path()+"$");for(e=0;e<r.allPages.length;e+=1)if(n.test(r.allPages[e].link))return r.allPages[e]}var r={locale:navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,development:e.development,loginUser:e.currentuser,lunchers:[],attendee:[],events:[],stocklist:[],allPages:[{name:"Home",icon:"action:home",link:"#/home"},{name:"Dashboard",icon:"action:dashboard",link:"#/dashboard"},{name:"Stock",icon:"action:trending-up",link:"#/stock"},{name:"Settings",icon:"action:settings",link:"#/setting"}]};return n.get("/db/luncher").success(function(t){var e,n=r.lunchers,a=r.attendee,o=r.loginUser;for(e=0;e<t.length;e+=1)5>e&&a.push(t[e]),n.push(t[e]),t[e].firstname===o.firstname&&t[e].lastname===o.lastname&&angular.extend(o,t[e])}),n.get("/db/event",{params:{count:2}}).success(function(t){r.events=t}),{getLuncher:a,getCurrentPage:o,get:function(t){return r[t]},set:function(t,e){r[t]=e}}}])}(),function(){var t=angular.module("fundFactory",[]);t.factory("luncherstat",["$http","$q",function(t,e){function n(){var t=e.defer(),n=[];return a.promise.then(function(e){angular.copy(e,n),t.resolve(n)}),t.promise}var a=e.defer();return t.get("/db/luncherstat").success(function(t){a.resolve(t)}).error(function(t){a.reject(t)}),{getData:n}}]),t.factory("stockstat",["$http","$q",function(t,e){function n(n){var a,o=e.defer();return a=n.map(function(t){return"'"+t+"'"}).join(","),t.get("https://query.yahooapis.com/v1/public/yql",{params:{q:"select * from yahoo.finance.quotes where symbol in ("+a+")",format:"json",env:"store://datatables.org/alltableswithkeys"}}).success(function(t){o.resolve(t)}).error(function(t){console.error(t),o.reject("Unable to retrieve stock data from YAHOO.")}),o.promise}return{getData:n}}])}(),function(){var t=angular.module("messageFactory",[]);t.factory("message",["$window",function(){function t(t,n){var a,o,r=e[t],i=0;for(n&&n.constructor===Array&&(i=n.length),a=0;i>a;a+=1)o=new RegExp("\\{"+a+"\\}","g"),r=r.replace(o,n[a]);return r}var e=({locale:navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage},{GENERIC:"{0}",INVALID_BILLAMOUNT:"Bill Amount {0} is not valid.",INVALID_FUNDHOLDER:"Please specify a fundholder.",NO_ATTENDEE:"No one is going to lunch?",SUBMIT_SUCCESS:"Lunchfund submitted successfully."});return{getMsg:t}}])}(),function(){var t=angular.module("copyright",[]);t.directive("copyright",function(){return{scope:{},restrict:"E",templateUrl:"app/copyright/copyright.html",replace:!0,controller:"CopyrightController",controllerAs:"CopyrightCtrl"}}),t.controller("CopyrightController",["$window",function(t){var e=this;angular.extend(e,{COPYRIGHT_TEXT:t.COPYRIGHT_TEXT,VERSION:t.VERSION})}])}(),function(){var t=angular.module("luncherSelect",["globalFactory"]);t.directive("luncherSelect",function(){return{scope:{},restrict:"E",templateUrl:"app/luncher-select/luncher-select.html",replace:!0,controller:"LuncherController",controllerAs:"LuncherCtrl"}}),t.controller("LuncherController",["global",function(t){function e(t){var e=o.attendee().indexOf(t);return-1!==e}function n(t){var e=o.attendee().indexOf(t);-1!==e?o.attendee().splice(e,1):o.attendee().push(t)}function a(){o.editMode=o.editMode.expand?r[0]:r[1]}var o=this,r=[{expand:!1,icon:"image:edit",text:"Edit"},{expand:!0,icon:"action:done",text:"Done"}];angular.extend(o,{editMode:r[0],lunchers:function(){return t.get("lunchers")},attendee:function(){return t.get("attendee")}}),angular.extend(o,{toggleEdit:a,isAttending:e,toggle:n})}])}(),function(){var t=angular.module("fundForm",["globalFactory","messageFactory","ngMessages"]);t.directive("fundForm",function(){return{scope:{},restrict:"E",templateUrl:"app/fund-form/fund-form.html",replace:!0,controller:"FundController",controllerAs:"FundCtrl"}}),t.controller("FundController",["$http","$mdDialog","global","message",function(t,e,n,a){function o(){return-1*(Math.ceil(4*d.baseTipsAmount)/4).toFixed(2)}function r(){return(Math.ceil(4*d.baseTipsAmount)/4).toFixed(2)}function i(){if(!d.billAmount)return 0;var t,e,n=10,a=d.attendee().length;return 0>=a?0:(t=Math.ceil(d.billAmount*(1+n/100)),d.baseTipsAmount=parseFloat((t-d.billAmount).toFixed(2)),d.tipsAmount=d.baseTipsAmount+d.tipOffset,d.tipsAmount<0&&(d.tipsAmount=0),d.tipPercent=d.tipsAmount/d.billAmount*100,d.totalAmount=d.tipsAmount+d.billAmount,d.eachPays=Math.ceil(d.totalAmount/a),e=d.eachPays*a,e-d.totalAmount)}function l(t){d.tipOffset+=t?.25:-.25}function c(t,n){e.show(e.alert().title("Error").content(t).ariaLabel("Error message").ok("OK").targetEvent(n))}function s(t,n){e.show(e.alert().content(t).ariaLabel("Informational message").ok("OK").targetEvent(n))}function u(t){return d.billAmount?d.fundholder?d.attendee().length?!0:(c(a.getMsg("NO_ATTENDEE"),t),!1):(c(a.getMsg("INVALID_FUNDHOLDER"),t),!1):(c(a.getMsg("INVALID_BILLAMOUNT",[d.billAmount]),t),!1)}function g(e){var o={time:d.eventdate,bill:d.billAmount,totalpaid:d.totalAmount,fund:i(),attendee:d.attendee(),fundholder:d.fundholder,submitter:n.get("loginUser")};u(e)&&t.post("db/event",o).success(function(){n.get("events").unshift(o),s(a.getMsg("SUBMIT_SUCCESS"),e)}).error(function(t){c(a.getMsg("GENERIC",[JSON.stringify(t)]),e)})}var d=this;angular.extend(d,{today:new Date,eventdate:new Date,attendee:function(){return n.get("attendee")},billAmount:"",baseTipsAmount:0,tipsAmount:0,tipPercent:0,tipOffset:0,totalAmount:0,eachPays:0,fundholder:""}),angular.extend(d,{bumpTipsOffset:l,tipOffsetFloor:o,tipOffsetCeil:r,getLunchfundAmount:i,submit:g})}])}(),function(){var t=angular.module("pastEvent",["globalFactory"]);t.directive("pastEvent",function(){return{scope:{},restrict:"E",templateUrl:"app/past-event/past-event.html",replace:!0,controller:"EventController",controllerAs:"EventCtrl"}}),t.controller("EventController",["global",function(t){var e=this;e.events=function(){return t.get("events")}}])}(),function(){var t=angular.module("fundChart",["googlechart","globalFactory","fundFactory"]);t.directive("fundChart",function(){return{scope:{},restrict:"AE",templateUrl:"app/fund-chart/fund-chart.html",replace:!0,controller:"FundChartController",controllerAs:"FundChartCtrl"}}),t.controller("FundChartController",["$filter","global","luncherstat",function(t,e,n){var a=this,o=e.get("loginUser"),r={},i={};angular.extend(a,{book:r,mkt:i}),r.total=0,r.type="BarChart",r.cssStyle="",r.data={cols:[{label:"",type:"string"}],rows:[{c:[{v:""}]}]},r.options={isStacked:"true",fill:20,vAxis:{gridlines:{count:0}},hAxis:{title:"Bookvalue ($)"}},r.formatters={},n.getData().then(function(n){var a,i=3,l={name:"Other",fund_contrib:0};for(n.sort(function(t,e){return e.total_fund_contrib-t.total_fund_contrib}),a=0;a<n.length;a+=1)i>a||n[a].luncher_id===o.id?(r.data.cols.push({label:e.getLuncher(n[a].luncher_id).username,type:"number"}),r.data.rows[0].c.push({v:n[a].total_fund_contrib,f:"$"+t("number")(n[a].total_fund_contrib,2)})):l.fund_contrib+=n[a].total_fund_contrib,r.total+=n[a].total_fund_contrib;r.data.cols.push({label:"Others",type:"number"}),r.data.rows[0].c.push({v:l.fund_contrib,f:"$"+t("number")(l.fund_contrib,2)})})}])}(),function(){var t=angular.module("fundStat",["globalFactory","fundFactory"]);t.directive("fundStat",function(){return{scope:{},restrict:"AE",templateUrl:"app/fund-stat/fund-stat.html",replace:!0,controller:"FundStatController",controllerAs:"FundStatCtrl"}}),t.controller("FundStatController",["$http","global","luncherstat",function(t,e,n){function a(){r.fundholderstatMode=r.fundholderstatMode.expand?i[0]:i[1]}function o(){r.lunchoutingstatMode=r.lunchoutingstatMode.expand?l[0]:l[1]}var r=this,i=[{expand:!1,icon:"navigation:expand-more",text:"Expand"},{expand:!0,icon:"navigation:expand-less",text:"Collapse"}],l=[{expand:!1,icon:"navigation:expand-more",text:"Expand"},{expand:!0,icon:"navigation:expand-less",text:"Collapse"}];angular.extend(r,{fundholderstatMode:i[0],fundholderstat:[],lunchoutingstatMode:l[0],lunchoutingstat:[]}),t.get("/db/fundholderstat").success(function(t){var n;for(n=0;n<t.length;n+=1)r.fundholderstat.push({username:e.getLuncher(t[n].fundholder).username,fund:t[n].funds})}),n.getData().then(function(t){var n;for(t.sort(function(t,e){return e.meal_count-t.meal_count}),n=0;n<t.length;n+=1)r.lunchoutingstat.push({username:e.getLuncher(t[n].luncher_id).username,meal_count:t[n].meal_count})}),angular.extend(r,{togglefundholder:a,togglelunchouting:o})}])}(),function(){var t=angular.module("stockChart",["globalFactory","fundFactory"]);t.directive("stockChart",function(){return{scope:{stocksymbol:"=symbol"},restrict:"E",templateUrl:"app/stock-chart/stock-chart.html",replace:!0,controller:"StockChartController",controllerAs:"StockChartCtrl",link:function(t){t.stocksymbol&&t.getStockQuote(),t.$watch("stocksymbol",function(e){e&&t.getStockQuote()})}}}),t.controller("StockChartController",["stockstat","$scope","$filter",function(t,e,n){function a(){return c+"&z=s&s="+e.stocksymbol+l.charts[l.tabindex].url}function o(){var t=c+"&s="+e.stocksymbol+l.charts[l.tabindex].url;return t+"&z=m 512w, "+t+"&z=l 800w"}function r(){l.tabindex=Math.min(l.tabindex+1,l.charts.length-1)}function i(){l.tabindex=Math.max(l.tabindex-1,0)}var l=this,c="http://chart.finance.yahoo.com/z?q=l&l=off&p=m50,m200";angular.extend(l,{isValidSym:!1,tabindex:3,charts:[{timespan:"1d",url:"&t=1d"},{timespan:"5d",url:"&t=5d"},{timespan:"3m",url:"&t=3m"},{timespan:"6m",url:"&t=6m"},{timespan:"1y",url:"&t=1y"},{timespan:"2y",url:"&t=2y"},{timespan:"5y",url:"&t=5y"},{timespan:"max",url:"&t=my"}]}),e.stock={},e.getStockQuote=function(){t.getData([e.stocksymbol]).then(function(t){var a,o=t.query.created;return a=1===t.query.count?t.query.results.quote:t.query.results.quote[0],null===a.Ask?(e.stock.name=a.Name,e.stock.symbol=a.symbol,void(l.isValidSym=!1)):(e.stock={name:a.Name,symbol:a.symbol,created:o,askdisp:n("currency")(a.Ask,a.Currency+" ",2),ask:a.Ask,change:n("number")(Math.abs(a.Change),2),currency:a.Currency,open:n("number")(a.Open,2),dayshigh:n("number")(a.DaysHigh,2),dayslow:n("number")(a.DaysLow,2),mktcap:a.MarketCapitalization,PEratio:a.PERatio,divyield:a.DividendYield},a.Change>0?(e.stock.changeicon="action:trending-up",e.stock.changestyle={color:"green"}):(e.stock.changeicon="action:trending-down",e.stock.changestyle={color:"red"}),void(l.isValidSym=!0))})},angular.extend(l,{nexttab:r,prevtab:i,getStockChartSrc:a,getStockChartSrcset:o})}])}();