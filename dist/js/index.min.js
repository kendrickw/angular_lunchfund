"use strict";!function(){var t=angular.module("index",["ui.router","angular-loading-bar","ngMaterial","templates","globalFactory","copyright","luncherSelect","fundForm","pastEvent","fundChart","fundStat","stockChart"]);t.config(["$stateProvider","$urlRouterProvider","$mdThemingProvider","$mdIconProvider",function(t,e,n,o){e.otherwise("/home"),t.state("home",{url:"/home",templateUrl:"app/routes/home.html"}).state("dashboard",{url:"/dashboard",templateUrl:"app/routes/dashboard.html"}).state("stock",{url:"/stock",templateUrl:"app/routes/stock.html",controller:"StockController",controllerAs:"StockCtrl"}).state("setting",{url:"/setting",templateUrl:"app/routes/setting.html"}),n.theme("default").primaryPalette("indigo").accentPalette("orange"),n.theme("dark").primaryPalette("yellow").dark(),o.icon("action:home","images/material-svg/action/ic_home_24px.svg",24).icon("action:dashboard","images/material-svg/action/ic_dashboard_24px.svg",24).icon("action:settings","images/material-svg/action/ic_settings_24px.svg",24).icon("action:done","images/material-svg/action/ic_done_24px.svg",24).icon("action:exit-to-app","images/material-svg/action/ic_exit_to_app_24px.svg",24).icon("action:account-balance-wallet","images/material-svg/action/ic_account_balance_wallet_24px.svg",24).icon("action:shopping-cart","images/material-svg/action/ic_shopping_cart_24px.svg",24).icon("action:trending-up","images/material-svg/action/ic_trending_up_24px.svg",24).icon("action:trending-down","images/material-svg/action/ic_trending_down_24px.svg",24).icon("content:add-circle","images/material-svg/content/ic_add_circle_24px.svg",24).icon("content:remove-circle","images/material-svg/content/ic_remove_circle_24px.svg",24).icon("content:undo","images/material-svg/content/ic_undo_24px.svg",24).icon("image:edit","images/material-svg/image/ic_edit_24px.svg",24).icon("navigation:chevron-right","images/material-svg/navigation/ic_chevron_right_24px.svg",24).icon("navigation:menu","images/material-svg/navigation/ic_menu_24px.svg",24).icon("navigation:refresh","images/material-svg/navigation/ic_refresh_24px.svg",24).icon("navigation:expand-more","images/material-svg/navigation/ic_expand_more_24px.svg",24).icon("navigation:expand-less","images/material-svg/navigation/ic_expand_less_24px.svg",24).icon("file:cloud-upload","images/material-svg/file/ic_cloud_upload_24px.svg",24)}]),t.run(["$http","$templateCache",function(t,e){var n=["images/material-svg/action/ic_home_24px.svg","images/material-svg/action/ic_dashboard_24px.svg","images/material-svg/action/ic_settings_24px.svg","images/material-svg/action/ic_exit_to_app_24px.svg","images/material-svg/action/ic_done_24px.svg","images/material-svg/action/ic_account_balance_wallet_24px.svg","images/material-svg/action/ic_shopping_cart_24px.svg","images/material-svg/action/ic_trending_up_24px.svg","images/material-svg/action/ic_trending_down_24px.svg","images/material-svg/content/ic_add_circle_24px.svg","images/material-svg/content/ic_remove_circle_24px.svg","images/material-svg/content/ic_undo_24px.svg","images/material-svg/image/ic_edit_24px.svg","images/material-svg/navigation/ic_chevron_right_24px.svg","images/material-svg/navigation/ic_menu_24px.svg","images/material-svg/navigation/ic_refresh_24px.svg","images/material-svg/navigation/ic_expand_more_24px.svg","images/material-svg/navigation/ic_expand_less_24px.svg","images/material-svg/file/ic_cloud_upload_24px.svg"];angular.forEach(n,function(n){t.get(n,{cache:e})})}]),t.controller("MenuController",["global","$mdSidenav",function(t,e){function n(t){e(t).toggle()}function o(t){e(t).close()}var a=this,r=function(){return t.get("loginUser")},i=[{title:"Email",text:r().email},{title:"Firstname",text:r().firstname},{title:"Lastname",text:r().lastname}];angular.extend(a,{development:t.get("development"),allPages:t.get("allPages"),getCurrentPage:t.getCurrentPage,loginUser:r,userdetail:i,toggleSidemenu:n,closeSidemenu:o})}]),t.controller("StockController",["global","$http","$q","$window",function(t,e,n,o){function a(t){return r=n.defer(),e.jsonp("http://d.yimg.com/autoc.finance.yahoo.com/autoc",{params:{callback:"YAHOO.Finance.SymbolSuggest.ssCallback",query:t}}).error(function(t){r.reject(t)}),r.promise}var r,i=this;angular.extend(i,{selectedItem:null,searchText:null,getWatchList:function(){return t.get("stocklist")}}),o.YAHOO={Finance:{SymbolSuggest:{}}},o.YAHOO.Finance.SymbolSuggest.ssCallback=function(t){var e=t.ResultSet.Result.map(function(t){return{symbol:t.symbol,name:t.name,exchange:t.exchDisp}});r.resolve(e)},angular.extend(i,{querySearch:a})}])}(),function(){var t=angular.module("globalFactory",[]);t.factory("global",["$location","$window","$http",function(t,e,n){function o(t){var e,n=r.lunchers;if(t<=n.length&&n[t-1].id===t)return n[t-1];for(e=0;e<n.length;e+=1)if(n[e].id===t)return n[e];return console.error("ID#"+t+" is not a valid luncher ID."),null}function a(){var e,n=new RegExp(t.path()+"$");for(e=0;e<r.allPages.length;e+=1)if(n.test(r.allPages[e].link))return r.allPages[e]}var r={locale:navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,development:e.development,loginUser:e.currentuser,lunchers:[],attendee:[],events:[],stocklist:[],allPages:[{name:"Home",icon:"action:home",link:"#/home"},{name:"Dashboard",icon:"action:dashboard",link:"#/dashboard"},{name:"Stock",icon:"action:trending-up",link:"#/stock"},{name:"Settings",icon:"action:settings",link:"#/setting"}]};return n.get("/db/luncher").success(function(t){var e,n=r.lunchers,o=r.attendee,a=r.loginUser;for(e=0;e<t.length;e+=1)5>e&&o.push(t[e]),n.push(t[e]),t[e].firstname===a.firstname&&t[e].lastname===a.lastname&&angular.extend(a,t[e])}),n.get("/db/stock").success(function(t){var e,n;for(e=0;e<t.length;e+=1)n={symbol:t[e].symbol,exchange:t[e].exchange},r.stocklist.push(n)}),n.get("/db/event",{params:{count:2}}).success(function(t){r.events=t}),{getLuncher:o,getCurrentPage:a,get:function(t){return r[t]},set:function(t,e){r[t]=e}}}])}(),function(){var t=angular.module("fundFactory",[]);t.factory("luncherstat",["$http","$q",function(t,e){function n(){var t=e.defer(),n=[];return o.promise.then(function(e){angular.copy(e,n),t.resolve(n)}),t.promise}var o=e.defer();return t.get("/db/luncherstat").success(function(t){o.resolve(t)}).error(function(t){o.reject(t)}),{getData:n}}]),t.factory("getstocklist",["$http","$q",function(t,e){function n(){var n=e.defer();return t.get("/db/stock").success(function(t){n.resolve(t)}).error(function(t){console.error(t),n.reject("Unable to retrieve stock data from YAHOO.")}),n.promise}return{getData:n}}]),t.factory("stockstat",["$http","$q",function(t,e){function n(n){var o=e.defer(),a=n.symbol;return a=a.substr(0,a.lastIndexOf("."))||a,t.get("http://www.google.com/finance/info",{params:{q:a}}).success(function(t){var e=angular.fromJson(t.substring(3));n.Ask=e[0].l,n.Change=e[0].c,o.resolve(e[0])}).error(function(t){console.error(t),o.reject("Unable to retrieve stock data from GOOGLE.")}),o.promise}function o(o){var a,r=e.defer();return a=o.map(function(t){return"'"+t+"'"}).join(","),t.get("https://query.yahooapis.com/v1/public/yql",{params:{q:"select * from yahoo.finance.quotes where symbol in ("+a+")",format:"json",env:"store://datatables.org/alltableswithkeys"}}).success(function(t){var o=[];1===t.query.count?null===t.query.results.quote.Ask&&o.push(n(t.query.results.quote)):angular.forEach(t.query.results.quote,function(t){null===t.Ask&&o.push(n(t))}),e.all(o).then(function(){r.resolve(t)},function(t){r.reject(t)})}).error(function(){r.reject("Unable to retrieve stock data from YAHOO.")}),r.promise}return{getData:o}}])}(),function(){var t=angular.module("messageFactory",["ngMaterial"]);t.factory("message",["$window","$mdDialog",function(t,e){function n(t,e){var n,o,a=r[t],i=0;for(e&&e.constructor===Array&&(i=e.length),n=0;i>n;n+=1)o=new RegExp("\\{"+n+"\\}","g"),a=a.replace(o,e[n]);return a}function o(t,o){var a=n(t,o);e.show(e.alert().title("Error").content(a).ariaLabel("Error message").ok("OK"))}function a(t,o){var a=n(t,o);e.show(e.alert().content(a).ariaLabel("Informational message").ok("OK"))}var r=({locale:navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage},{GENERIC:"{0}",INVALID_BILLAMOUNT:"Bill Amount {0} is not valid.",INVALID_FUNDHOLDER:"Please specify a fundholder.",NO_ATTENDEE:"No one is going to lunch?",SUBMIT_SUCCESS:"Lunchfund submitted successfully.",WATCHLIST_ADD_SUCCESS:"{0} added to watchlist",WATCHLIST_REMOVE_SUCCESS:"{0} removed from watchlist",STOCKEVENT_ADD_SUCCESS:"{0} added to stockevent"});return{getMsg:n,showError:o,showInfo:a}}])}(),function(){var t=angular.module("copyright",[]);t.directive("copyright",function(){return{scope:{},restrict:"E",templateUrl:"app/copyright/copyright.html",replace:!0,controller:"CopyrightController",controllerAs:"CopyrightCtrl"}}),t.controller("CopyrightController",["$window",function(t){var e=this;angular.extend(e,{COPYRIGHT_TEXT:t.COPYRIGHT_TEXT,VERSION:t.VERSION})}])}(),function(){var t=angular.module("luncherSelect",["globalFactory"]);t.directive("luncherSelect",function(){return{scope:{},restrict:"E",templateUrl:"app/luncher-select/luncher-select.html",replace:!0,controller:"LuncherController",controllerAs:"LuncherCtrl"}}),t.controller("LuncherController",["global",function(t){function e(t){var e=a.attendee().indexOf(t);return-1!==e}function n(t){var e=a.attendee().indexOf(t);-1!==e?a.attendee().splice(e,1):a.attendee().push(t)}function o(){a.editMode=a.editMode.expand?r[0]:r[1]}var a=this,r=[{expand:!1,icon:"image:edit",text:"Edit"},{expand:!0,icon:"action:done",text:"Done"}];angular.extend(a,{editMode:r[0],lunchers:function(){return t.get("lunchers")},attendee:function(){return t.get("attendee")}}),angular.extend(a,{toggleEdit:o,isAttending:e,toggle:n})}])}(),function(){var t=angular.module("fundForm",["globalFactory","messageFactory","ngMessages"]);t.directive("fundForm",function(){return{scope:{},restrict:"E",templateUrl:"app/fund-form/fund-form.html",replace:!0,controller:"FundController",controllerAs:"FundCtrl"}}),t.controller("FundController",["$http","global","message",function(t,e,n){function o(){return-1*(Math.ceil(4*l.baseTipsAmount)/4).toFixed(2)}function a(){return(Math.ceil(4*l.baseTipsAmount)/4).toFixed(2)}function r(){if(!l.billAmount)return 0;var t,e,n=10,o=l.attendee().length;return 0>=o?0:(t=Math.ceil(l.billAmount*(1+n/100)),l.baseTipsAmount=parseFloat((t-l.billAmount).toFixed(2)),l.tipsAmount=l.baseTipsAmount+l.tipOffset,l.tipsAmount<0&&(l.tipsAmount=0),l.tipPercent=l.tipsAmount/l.billAmount*100,l.totalAmount=l.tipsAmount+l.billAmount,l.eachPays=Math.ceil(l.totalAmount/o),e=l.eachPays*o,e-l.totalAmount)}function i(t){l.tipOffset+=t?.25:-.25}function s(){return l.billAmount?l.fundholder?l.attendee().length?!0:(n.showError("NO_ATTENDEE"),!1):(n.showError("INVALID_FUNDHOLDER"),!1):(n.showError("INVALID_BILLAMOUNT",[l.billAmount]),!1)}function c(o){var a={time:l.eventdate,bill:l.billAmount,totalpaid:l.totalAmount,fund:r(),attendee:l.attendee(),fundholder:l.fundholder,submitter:e.get("loginUser")};s(o)&&t.post("db/event",a).success(function(){e.get("events").unshift(a),n.showInfo("SUBMIT_SUCCESS")}).error(function(t){n.showError("GENERIC",[JSON.stringify(t)])})}var l=this;angular.extend(l,{today:new Date,eventdate:new Date,attendee:function(){return e.get("attendee")},billAmount:"",baseTipsAmount:0,tipsAmount:0,tipPercent:0,tipOffset:0,totalAmount:0,eachPays:0,fundholder:""}),angular.extend(l,{bumpTipsOffset:i,tipOffsetFloor:o,tipOffsetCeil:a,getLunchfundAmount:r,submit:c})}])}(),function(){var t=angular.module("pastEvent",["globalFactory"]);t.directive("pastEvent",function(){return{scope:{},restrict:"E",templateUrl:"app/past-event/past-event.html",replace:!0,controller:"EventController",controllerAs:"EventCtrl"}}),t.controller("EventController",["global",function(t){var e=this;e.events=function(){return t.get("events")}}])}(),function(){var t=angular.module("fundChart",["googlechart","globalFactory","fundFactory"]);t.directive("fundChart",function(){return{scope:{},restrict:"AE",templateUrl:"app/fund-chart/fund-chart.html",replace:!0,controller:"FundChartController",controllerAs:"FundChartCtrl"}}),t.controller("FundChartController",["$filter","global","luncherstat",function(t,e,n){var o=this,a=e.get("loginUser"),r={},i={};angular.extend(o,{book:r,mkt:i}),r.total=0,r.type="BarChart",r.cssStyle="",r.data={cols:[{label:"",type:"string"}],rows:[{c:[{v:""}]}]},r.options={isStacked:"true",fill:20,vAxis:{gridlines:{count:0}},hAxis:{title:"Bookvalue ($)"}},r.formatters={},n.getData().then(function(n){var o,i=3,s={name:"Other",fund_contrib:0};for(n.sort(function(t,e){return e.total_fund_contrib-t.total_fund_contrib}),o=0;o<n.length;o+=1)i>o||n[o].luncher_id===a.id?(r.data.cols.push({label:e.getLuncher(n[o].luncher_id).username,type:"number"}),r.data.rows[0].c.push({v:n[o].total_fund_contrib,f:"$"+t("number")(n[o].total_fund_contrib,2)})):s.fund_contrib+=n[o].total_fund_contrib,r.total+=n[o].total_fund_contrib;r.data.cols.push({label:"Others",type:"number"}),r.data.rows[0].c.push({v:s.fund_contrib,f:"$"+t("number")(s.fund_contrib,2)})})}])}(),function(){var t=angular.module("fundStat",["globalFactory","fundFactory"]);t.directive("fundStat",function(){return{scope:{},restrict:"AE",templateUrl:"app/fund-stat/fund-stat.html",replace:!0,controller:"FundStatController",controllerAs:"FundStatCtrl"}}),t.controller("FundStatController",["$http","global","luncherstat",function(t,e,n){function o(){r.fundholderstatMode=r.fundholderstatMode.expand?i[0]:i[1]}function a(){r.lunchoutingstatMode=r.lunchoutingstatMode.expand?s[0]:s[1]}var r=this,i=[{expand:!1,icon:"navigation:expand-more",text:"Expand"},{expand:!0,icon:"navigation:expand-less",text:"Collapse"}],s=[{expand:!1,icon:"navigation:expand-more",text:"Expand"},{expand:!0,icon:"navigation:expand-less",text:"Collapse"}];angular.extend(r,{fundholderstatMode:i[0],fundholderstat:[],lunchoutingstatMode:s[0],lunchoutingstat:[]}),t.get("/db/fundholderstat").success(function(t){var n;for(n=0;n<t.length;n+=1)r.fundholderstat.push({username:e.getLuncher(t[n].fundholder).username,fund:t[n].funds})}),n.getData().then(function(t){var n;for(t.sort(function(t,e){return e.meal_count-t.meal_count}),n=0;n<t.length;n+=1)r.lunchoutingstat.push({username:e.getLuncher(t[n].luncher_id).username,meal_count:t[n].meal_count})}),angular.extend(r,{togglefundholder:o,togglelunchouting:a})}])}(),function(){var t=angular.module("stockChart",["globalFactory","fundFactory","messageFactory"]);t.directive("stockChart",function(){return{scope:{stocksymbol:"=symbol"},restrict:"E",templateUrl:"app/stock-chart/stock-chart.html",replace:!0,controller:"StockChartController",controllerAs:"StockChartCtrl",link:function(t){t.stocksymbol&&t.getStockQuote(),t.$watch("stocksymbol",function(e,n){e!==n&&t.getStockQuote()})}}}),t.controller("StockChartController",["global","stockstat","$scope","$filter","$http","message",function(t,e,n,o,a,r){function i(){return b+"&z=s&s="+n.stocksymbol+_.charts[_.tabindex].url}function s(){var t=b+"&s="+n.stocksymbol+_.charts[_.tabindex].url;return t+"&z=m 512w, "+t+"&z=l 800w"}function c(){_.tabindex=Math.min(_.tabindex+1,_.charts.length-1)}function l(){_.tabindex=Math.max(_.tabindex-1,0)}function u(){a.get("/db/stockevent",{params:{symbol:n.stocksymbol}}).success(function(t){var e,n;for(_.stockevent=[],e=0;e<t.length;e+=1)n={time:t[e].time,buy:t[e].buy,position:t[e].position,price:t[e].price,fee:t[e].fee},_.stockevent.push(n)})}function g(){var e,o=t.get("stocklist");for(e=0;e<o.length;e+=1)if(o[e].symbol===n.stocksymbol)return e;return-1}function m(){a.post("db/stock",n.stock).success(function(){r.showInfo("WATCHLIST_ADD_SUCCESS",[n.stock.symbol]),t.get("stocklist").unshift(n.stock)}).error(function(t){r.showError("GENERIC",[JSON.stringify(t)])})}function d(e){a["delete"]("db/stock/"+n.stock.symbol).success(function(){r.showInfo("WATCHLIST_REMOVE_SUCCESS",[n.stock.symbol]),t.get("stocklist").splice(e,1)}).error(function(t){r.showError("GENERIC",[JSON.stringify(t)])})}function f(){_.stockform.symbol=n.stock.symbol,_.stockform.buy="BUY"===_.stockform.type?1:0,a.post("db/stockevent",_.stockform).success(function(){r.showInfo("STOCKEVENT_ADD_SUCCESS",[_.stockform.symbol])}).error(function(t){r.showError("GENERIC",[JSON.stringify(t)])})}function p(){var t=g();-1===t?m():d(t)}function h(){return-1===g()?"content:add-circle":"content:remove-circle"}function v(){_.exposeForm=!_.exposeForm}var _=this,b="http://chart.finance.yahoo.com/z?q=l&l=off&p=m50,m200";angular.extend(_,{today:new Date,isValidSym:!1,tabindex:3,exposeForm:!1,stockevent:[],stockform:{time:new Date},charts:[{timespan:"1d",url:"&t=1d"},{timespan:"5d",url:"&t=5d"},{timespan:"3m",url:"&t=3m"},{timespan:"6m",url:"&t=6m"},{timespan:"1y",url:"&t=1y"},{timespan:"2y",url:"&t=2y"},{timespan:"5y",url:"&t=5y"},{timespan:"max",url:"&t=my"}]}),n.stock={},n.getStockQuote=function(){e.getData([n.stocksymbol]).then(function(t){var e,a=t.query.created;return e=1===t.query.count?t.query.results.quote:t.query.results.quote[0],null===e.Ask?(n.stock.name=e.Name,n.stock.symbol=e.symbol,void(_.isValidSym=!1)):(n.stock={name:e.Name,symbol:e.symbol,exchange:e.StockExchange,created:a,askdisp:o("currency")(e.Ask,e.Currency+" ",2),ask:e.Ask,change:o("number")(Math.abs(e.Change),2),currency:e.Currency,open:o("number")(e.Open,2),dayshigh:o("number")(e.DaysHigh,2),dayslow:o("number")(e.DaysLow,2),mktcap:e.MarketCapitalization,PEratio:e.PERatio,divyield:e.DividendYield},e.Change>0?(n.stock.changeicon="action:trending-up",n.stock.changestyle={color:"green"}):(n.stock.changeicon="action:trending-down",n.stock.changestyle={color:"red"}),_.isValidSym=!0,void u())})},angular.extend(_,{nexttab:c,prevtab:l,getStockChartSrc:i,getStockChartSrcset:s,toggleWatchList:p,getToggleIcon:h,toggleBuySell:v,addToStockevent:f})}])}();